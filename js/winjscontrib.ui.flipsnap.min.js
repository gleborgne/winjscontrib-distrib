/* 
 * WinJS Contrib v2.0.3.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{FlipSnap:WinJS.Class.mix(WinJS.Class.define(function(t,i){var e=this;this.element=t||document.createElement("DIV"),i=i||{},this.element.winControl=this,this.element.classList.add("win-disposable"),this.element.classList.add("mcn-layout-ctrl"),this.element.classList.add("flipsnapcontainer"),this.list=document.createElement("DIV"),this.list.classList.add("flipsnaplist"),this.element.appendChild(this.list),WinJS.UI.setOptions(this,i),e._itemTemplate=i.itemTemplate,e._itemMaxWidth=i.itemMaxWidth,e._itemMaxWidth||(e._itemMaxWidth=800),e._itemMaxMarge=i.itemMaxMarge,e._itemMaxMarge||(e._itemMaxMarge=10),e._currentPosition=i.currentPosition,e._currentPosition||(e._currentPosition=0),e.style=document.createElement("style"),e.listOnscrollbinded=e.listOnscroll.bind(e),e.element.appendChild(e.style),e.list.addEventListener("scroll",e.listOnscrollbinded),e.updateLayout(),e._navBtns()},{_navBtns:function(){var t=this;t.next=document.createElement("button"),t.next.innerHTML="&#57571;",t.next.className="navbutton navbutton-right hide",t.prev=document.createElement("button"),t.prev.innerHTML="&#57570;",t.prev.className="navbutton navbutton-left hide",t.element.appendChild(t.next),t.element.appendChild(t.prev),WinJSContrib.UI.tap(t.next,function(){t.toNext()}),WinJSContrib.UI.tap(t.prev,function(){t.toPrev()})},listOnscroll:function(){var t=this;t._timeout&&clearTimeout(t._timeout),t._timeout=setTimeout(function(){var i=Math.round(t.list.scrollLeft/t._itemw);if(t._currentPosition!==i){t._currentPosition=i;for(var e=t.list.querySelectorAll(".selected"),n=0,s=e.length;s>n;n++)e[n].classList.remove("selected");t.list.children[t._currentPosition].classList.add("selected"),t.dispatchEvent("positionchanged",{currentPosition:t._currentPosition}),t.canGoForward?t.next.classList.remove("hide"):t.next.classList.add("hide"),t.canGoBack?t.prev.classList.remove("hide"):t.prev.classList.add("hide"),console.log(t._currentPosition)}},0)},_navPromises:[],toNext:function(){var t=this;WinJS.Promise.join(t._navPromises).then(function(){t._navPromises.push(t._smooth_scroll_to(t.list,(t._itemw+t._itemMaxMarge)*(t._currentPosition+1),300))},function(){})},toPrev:function(){var t=this;WinJS.Promise.join(t._navPromises).then(function(){var i=t._currentPosition-1;0>i&&(i=0),t._navPromises.push(t._smooth_scroll_to(t.list,(t._itemw+t._itemMaxMarge)*i,300))},function(){})},_smooth_scroll_to:function(t,i,e){if(i=Math.round(i),e=Math.round(e),0>e)return Promise.reject("bad duration");if(0===e)return t.scrollLeft=i,Promise.resolve();var n=Date.now(),s=n+e,r=t.scrollLeft,o=i-r,a=function(t,i,e){if(t>=e)return 0;if(e>=i)return 1;var n=(e-t)/(i-t);return n*n*(3-2*n)};return new WinJS.Promise(function(i){try{var e=t.scrollLeft,l=function(){if(t.scrollLeft!=e)return void i();var c=Date.now(),m=a(n,s,c),u=Math.round(r+o*m);return t.scrollLeft=u,c>=s?void i():t.scrollLeft===e&&t.scrollLeft!==u?void i():(e=t.scrollLeft,void setTimeout(l,0))};setTimeout(l,0)}catch(c){}})},initList:function(t,i){var e=this,n=e._itemTemplate;if(!n)throw"Where is the tempalte ?";n=WinJSContrib.Utils.getTemplate(n);var s=[];return t&&t.length&&(e._dataList=t,t.length>1&&e.next.classList.remove("hide"),t.forEach(function(r,o){r&&s.push(n.render(r).done(function(n){var s=n.children[0];if(0==o&&(s.classList.add("flipsnapfistitem"),s.classList.add("selected")),s.classList.add("flipsnapitem"),i(s,r,o),e.list.appendChild(s),o+1===t.length){var a=document.createElement("div");a.className="flipsnaplastitem",e.list.appendChild(a)}}))})),WinJS.Promise.join(s).then(function(){setTimeout(function(){e.list.scrollLeft=(e._itemw+e._itemMaxMarge)*e._currentPosition},50)})},reset:function(){},itemTemplate:{get:function(){return this._itemTemplate},set:function(t){this._itemTemplate=t}},canGoBack:{get:function(){return 0==this._currentPosition?!1:!0}},dataList:{get:function(){return this._dataList?this._dataList:[]}},canGoForward:{get:function(){return this._currentPosition+1<this.dataList.length}},currentPosition:{get:function(){return this._currentPosition},set:function(t){var i=this;i._currentPosition=t,i._navPromises.push(i._smooth_scroll_to(i.list,(i._itemw+i._itemMaxMarge)*i._currentPosition,300))}},itemMaxWidth:{get:function(){return this._itemMaxWidth},set:function(t){this._itemMaxWidth=t}},dispose:function(){var t=this;t.list.removeEventListener("scroll",t.listOnscroll),WinJS.Utilities.disposeSubTree(this.element),this.element=null},updateLayout:function(){var t=this,i=window.innerWidth;t._itemw=t._itemMaxWidth;var e=(i-t._itemMaxWidth)/2,n=t._itemMaxMarge;800>i&&(t._itemw=i,e=0,n=0),t.currentPosition&&(t.list.scrollLeft=(t._itemw+t._itemMaxMarge)*t.currentPosition),t.style.innerHTML=".flipsnapcontainer .flipsnaplist{ -ms-scroll-snap-points-x: snapInterval(0%, "+t._itemw+t._itemMaxMarge+"px); } .flipsnapcontainer  .flipsnaplist .flipsnapitem.flipsnapfistitem { margin-left:"+e+"px } .flipsnaplist .flipsnapitem{ min-width:"+t._itemw+"px }  .flipsnapcontainer .flipsnaplist .flipsnaplastitem { max-width:"+e+"px ; min-width:"+e+"px } .flipsnapcontainer .flipsnaplist .flipsnapitem {margin-right:"+n+"px }"}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("positionchanged"))})}();