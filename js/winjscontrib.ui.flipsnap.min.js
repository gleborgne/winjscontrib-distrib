/* 
 * WinJS Contrib v2.1.0.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{FlipSnap:WinJS.Class.mix(WinJS.Class.define(function(t,e){var i=this;this.element=t||document.createElement("DIV"),e=e||{},this.element.winControl=this,this.element.classList.add("win-disposable"),this.element.classList.add("mcn-layout-ctrl"),this.element.classList.add("flipsnapcontainer"),this.list=document.createElement("DIV"),this.list.classList.add("flipsnaplist"),this.element.appendChild(this.list),this._navPromises=[],WinJS.UI.setOptions(this,e),i._itemTemplate=e.itemTemplate,i._itemMaxWidth=e.itemMaxWidth,i._itemMaxWidth||(i._itemMaxWidth=800),i._itemMaxMarge=e.itemMaxMarge,i._itemMaxMarge||(i._itemMaxMarge=10),i._itemClassName=e.itemClassName,i._currentPosition=e.currentPosition,i._currentPosition||(i._currentPosition=0),i.style=document.createElement("style"),i.listOnscrollbinded=i.listOnscroll.bind(i),i.element.appendChild(i.style),i.list.addEventListener("scroll",i.listOnscrollbinded),i._itemListRendred=[],i.updateLayout(),i._navBtns()},{_navBtns:function(){var t=this;t.next=document.createElement("button"),t.next.innerHTML="&#57571;",t.next.className="navbutton navbutton-right hide",t.prev=document.createElement("button"),t.prev.innerHTML="&#57570;",t.prev.className="navbutton navbutton-left hide",t.element.appendChild(t.next),t.element.appendChild(t.prev),WinJSContrib.UI.tap(t.next,function(){t.toNext()}),WinJSContrib.UI.tap(t.prev,function(){t.toPrev()})},listOnscroll:function(){var t=this;t._timeout&&clearTimeout(t._timeout),t._timeout=setTimeout(function(){var e=Math.round(t.list.scrollLeft/(t._itemw+t._margeItem()));if(t._currentPosition!==e){t._currentPosition=e;for(var i=t.list.querySelectorAll(".selected"),n=0,s=i.length;s>n;n++)i[n].classList.remove("selected");t._setStateNavBtns(),t.list.children[t._currentPosition].classList.add("selected"),t.dispatchEvent("positionchanged",{currentPosition:t._currentPosition}),t.renderItems(),console.log(t._currentPosition)}},0)},_setStateNavBtns:function(){var t=this;t.canGoForward?t.next.classList.remove("hide"):t.next.classList.add("hide"),t.canGoBack?t.prev.classList.remove("hide"):t.prev.classList.add("hide")},toNext:function(){var t=this;WinJS.Promise.join(t._navPromises).then(function(){t._navPromises.push(t._smooth_scroll_to(t.list,(t._itemw+t._margeItem())*(t._currentPosition+1),300))},function(){})},toPrev:function(){var t=this;WinJS.Promise.join(t._navPromises).then(function(){var e=t._currentPosition-1;0>e&&(e=0),t._navPromises.push(t._smooth_scroll_to(t.list,(t._itemw+t._margeItem())*e,300))},function(){})},_smooth_scroll_to:function(t,e,i){if(e=Math.round(e),i=Math.round(i),0>i)return Promise.reject("bad duration");if(0===i)return t.scrollLeft=e,Promise.resolve();var n=Date.now(),s=n+i,r=t.scrollLeft,o=e-r,a=function(t,e,i){if(t>=i)return 0;if(i>=e)return 1;var n=(i-t)/(e-t);return n*n*(3-2*n)};return new WinJS.Promise(function(e){try{var i=t.scrollLeft,l=function(){if(t.scrollLeft!=i)return void e();var c=Date.now(),m=a(n,s,c),d=Math.round(r+o*m);return t.scrollLeft=d,c>=s?void e():t.scrollLeft===i&&t.scrollLeft!==d?void e():(i=t.scrollLeft,void requestAnimationFrame(l))};requestAnimationFrame(l)}catch(c){}})},initList:function(t,e){var i=this,n=i._itemTemplate;if(!n)throw"Where is the tempalte ?";n=WinJSContrib.Utils.getTemplate(n);t&&t.length&&(i._dataList=t,t.length>1&&i.next.classList.remove("hide"),t.forEach(function(s,r){if(s){s.rendred=!1;var o=document.createElement("div");0==r&&o.classList.add("flipsnapfistitem"),r==i._currentPosition&&o.classList.add("selected"),i._itemClassName&&o.classList.add(i._itemClassName),o.classList.add("flipsnapitem"),i.list.appendChild(o),i._itemListRendred.push(function(){return s.rendred?WinJS.Promise.wrap({}):(s.rendred=!0,n.render(s,o).done(function(n){var o=n;if(e(o,s,r),r+1===t.length){var a=document.createElement("div");a.className="flipsnaplastitem",i.list.appendChild(a)}}))})}})),i.renderItems().then(function(){requestAnimationFrame(function(){i._setStateNavBtns(),i.list.scrollLeft=(i._itemw+i._margeItem())*i._currentPosition,i.dispatchEvent("positionchanged",{currentPosition:i._currentPosition})})})},renderItems:function(){var t=this,e=[];return 0==t._currentPosition?(e.push(t._itemListRendred[0]()),t._itemListRendred.length>1&&e.push(t._itemListRendred[1]()),t._itemListRendred.length>2&&e.push(t._itemListRendred[2]())):(t._itemListRendred[t._currentPosition]&&e.push(t._itemListRendred[t._currentPosition]()),t._itemListRendred[t._currentPosition-1]&&e.push(t._itemListRendred[t._currentPosition-1]()),t._itemListRendred[t._currentPosition-2]&&e.push(t._itemListRendred[t._currentPosition-2]()),t._itemListRendred[t._currentPosition+1]&&e.push(t._itemListRendred[t._currentPosition+1]()),t._itemListRendred[t._currentPosition+2]&&e.push(t._itemListRendred[t._currentPosition+2]())),WinJS.Promise.join(e)},itemTemplate:{get:function(){return this._itemTemplate},set:function(t){this._itemTemplate=t}},canGoBack:{get:function(){return 0==this._currentPosition?!1:!0}},canGoForward:{get:function(){return this._currentPosition+1<this.dataList.length}},dataList:{get:function(){return this._dataList?this._dataList:[]}},currentPosition:{get:function(){return this._currentPosition},set:function(t){var e=this;e._currentPosition=t,e._navPromises.push(e._smooth_scroll_to(e.list,(e._itemw+e._margeItem())*e._currentPosition,300))}},itemMaxWidth:{get:function(){return this._itemMaxWidth},set:function(t){this._itemMaxWidth=t}},_margeItem:function(){var t=this,e=t._itemMaxMarge;return window.innerWidth<800&&(t._itemw=window.innerWidth,e=0),e},updateLayout:function(){var t=this,e=window.innerWidth;t._itemw=t._itemMaxWidth;var i=(e-t._itemMaxWidth)/2;800>e&&(i=0);var n=t._margeItem();t.currentPosition&&(t.list.scrollLeft=(t._itemw+n)*t.currentPosition),t.style.innerHTML=".flipsnapcontainer .flipsnaplist{ -ms-scroll-snap-points-x: snapInterval(0%, "+(t._itemw+n)+"px); } .flipsnapcontainer  .flipsnaplist .flipsnapitem.flipsnapfistitem { margin-left:"+i+"px } .flipsnaplist .flipsnapitem{ min-width:"+t._itemw+"px;  width:"+t._itemw+"px }  .flipsnapcontainer .flipsnaplist .flipsnaplastitem { max-width:"+i+"px ; min-width:"+i+"px } .flipsnapcontainer .flipsnaplist .flipsnapitem {margin-right:"+n+"px }"},dispose:function(){var t=this;t.list.removeEventListener("scroll",t.listOnscroll),WinJS.Utilities.disposeSubTree(this.element),this.element=null}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("positionchanged"))})}();