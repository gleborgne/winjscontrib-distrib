/* 
 * WinJS Contrib v2.1.0.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var WinJSContrib=WinJSContrib||{};WinJSContrib.WinRT=WinJSContrib.WinRT||{},WinJSContrib.WinRT.SSM=WinJSContrib.WinRT.SSM||{},function(e){"use strict";function t(t){try{var i=t.adaptiveSource.uri.displayUri.toString();d.bitrate=0,d.videoH=0,d.videoW=0,d.available="",d.status="opened",e.log("SSM AdaptiveSource Opened: "+i)}catch(a){e.log("SSM open error"+a.number.toString())}}function i(){try{e.log("SSM AdaptiveSource Closed: "),d.bitrate=0,d.videoH=0,d.videoW=0,d.available="",d.status="closed"}catch(t){log("SSM close error"+t.number.toString())}}function a(){try{e.log("SSM manifestready"),d.status="manifest ready"}catch(t){e.log("error"+t.number.toString())}}function n(t){try{var i,a=t.updateType.toString();switch(parseInt(a)){case 4:if(i="BitrateChanged",t.additionalInfo){var n=t.additionalInfo.split(";");d.bitrate=n[0]/1e3}break;case 5:i="ChunkConnectHttpInvalid";break;case 8:i="ChunkHdrError";break;case 7:i="ChunkHdrHttpInvalid";break;case 9:i="EndOfLive";break;case 6:i="NextChunkHttpInvalid";break;case 10:i="OutsideWindowEdge";break;case 2:i="Rebuffer";break;case 3:i="StartEndTime";break;case 1:i="Underrun";break;case 1:i="Unknown";break;default:i="Unknown"}"Unknown"!=i&&(d.status=i,e.log(i+":  Startime: "+t.startTime.toString()+" Endtime: "+t.endTime.toString())),r(t)}catch(o){e.log("SSM status error "+o.number.toString())}}function r(e){var t=e.adaptiveSource.manifest.selectedStreams.filter(function(e){return e.name.indexOf("video")>=0});if(t&&t.length)if(d.videoH=t[0].maxHeight,d.videoW=t[0].maxWidth,t[0].availableTracks&&t[0].availableTracks.length){if(!d.available){var i=[];t[0].availableTracks.forEach(function(e){i.push("["+e.maxWidth+", "+e.maxHeight+"]")}),d.available=i.join(",")}}else d.available="";else d.videoH=0,d.videoW=0,d.available="";d.time=(new Date).toTimeString()}var o=WinJS.Binding.define({status:"",bitrate:0,videoW:0,videoH:0,time:"",available:""}),d=new o;WinJSContrib.WinRT.SSM.currentStatus=d,WinJSContrib.WinRT.SSM.log=function(e){WinJS&&WinJS.log&&WinJS.log(e)},WinJSContrib.WinRT.SSM.registerSSM=function(e){var r=new Windows.Media.MediaExtensionManager,o=new Windows.Foundation.Collections.PropertySet,d=Microsoft.Media.AdaptiveStreaming.AdaptiveSourceManager.getDefault();e&&(d.addEventListener("adaptivesourceopenedevent",t,!1),d.addEventListener("adaptivesourceclosedevent",i,!1),d.addEventListener("manifestreadyevent",a,!1),d.addEventListener("adaptivesourcestatusupdatedevent",n,!1)),o["{A5CE1DE8-1D00-427B-ACEF-FB9A3C93DE2D}"]=d,r.registerByteStreamHandler("Microsoft.Media.AdaptiveStreaming.SmoothByteStreamHandler",".ism","text/xml",o),r.registerByteStreamHandler("Microsoft.Media.AdaptiveStreaming.SmoothByteStreamHandler",".ism","application/vnd.ms-ss",o)},WinJSContrib.WinRT.SSM.unregisterSSM=function(){var e=Microsoft.Media.AdaptiveStreaming.AdaptiveSourceManager.getDefault();e.removeEventListener("adaptivesourceopenedevent",t),e.removeEventListener("adaptivesourceclosedevent",i),e.removeEventListener("manifestreadyevent",a)}}(WinJSContrib.WinRT.SSM);