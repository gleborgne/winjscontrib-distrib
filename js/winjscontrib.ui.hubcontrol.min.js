/* 
 * WinJS Contrib v2.0.1.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{HubControl:WinJS.Class.define(function(t,e){var n=this;if(e=e||{},n.element=t,n.savestate=void 0!=e.savestate?e.savestate:!0,n.scrollContainer=e&&e.scrollContainer?e.scrollContainer:t,n.sectionsContainer=e&&e.sectionsContainer?e.sectionsContainer:t.querySelector(".mcn-hub-surface"),!n.sectionsContainer){for(n.sectionsContainer=document.createElement("DIV"),n.sectionsContainer.className="mcn-hub-surface";t.children[0];)n.sectionsContainer.appendChild(t.children[0]);t.appendChild(n.sectionsContainer)}n.element.className=n.element.className+" mcn-hub-ctrl mcn-layout-ctrl win-disposable",n.element.winControl=n,n.sections=[],n.multipass=e.multipass,n.hubScrolledBind=n.hubScrolled.bind(n),n.rendering={lastScroll:0},n.identifier=n.element.id+"//"+n.element.className;var i=WinJSContrib.Utils.getScopeControl(n.element);i.elementReady&&i.elementReady.then(function(){return i.beforeShow||(i.beforeShow=[]),i.beforeShow.push(function(){n.layout()}),i.renderComplete}).then(function(){return n.prepare(),i.readyComplete})},{prepare:function(){this.autoRegisterSections()},multipass:{get:function(){return this._multipass},set:function(t){this._multipass=t}},orientation:{get:function(){return this._orientation},set:function(t){this._orientation=t}},autoRegisterSections:function(){var t=this;t.sections=[];for(var e=t.scrollContainer.querySelectorAll(".mcn-hub-section"),n=0;n<e.length;n++){var i=e[n],o=i.winControl;o&&t.sections.push(o)}},registerSection:function(t,e){var n=new Section(t,e);return this.sections.push(n),n},layout:function(t){var e=this;e.element.style.display="";var n=document.createElement("DIV");n.className="mcn-hub-section-spacer",e.sectionsContainer.appendChild(n),e.sections.length||e.autoRegisterSections(),this.sections.forEach(function(n){n.hub=e,n.layout(t),n._attachItemsControls()})},_attachItemsControls:function(){var t=this;t.sections.forEach(function(e){e.hub=t,e._attachItemsControls()})},renderItemsContent:function(t){var e=this;e.rendering.size={width:e.scrollContainer.clientWidth,height:e.scrollContainer.clientHeight},e.multipass||e.sections.forEach(function(n){n.hub=e,n.renderItemsContent(t)})},renderSection:function(t,e,n){var i=this;return t.hub=i,new WinJS.Promise(function(o){var s=WinJSContrib.Utils.getTemplate(e);if(s){var r=document.createElement("DIV");n&&(r.className="mcn-hub-section-titled"),s.render(t).done(function(t){for(var e=new WinJSContrib.UI.HubSection(r);t.children[0];)r.appendChild(t.children[0]);i.sectionsContainer.appendChild(r),i.sections.push(e),o(e)})}})},removeSection:function(){var t=this,e=t.sections.indexOf(val);e>-1&&t.sections.splice(e,1)},saveCtrlState:function(){var t=this,e=WinJS.Navigation.history.current.state||{hub:{}};if(e.hub||(e.hub={}),t.scrollContainer){var n={};n.scrollLeft=t.scrollContainer.scrollLeft,n.scrollTop=t.scrollContainer.scrollTop,e.hub[t.identifier]=n}return WinJS.Navigation.history.current.state=e,e},restoreCtrlState:function(t){var e=this;if(t=t||WinJS.Navigation.history.current.state||{hub:{}},t.hub||(t.hub={}),e.scrollContainer&&t.hub){var n=t.hub[e.identifier];n&&n.scrollLeft&&(e.scrollContainer.scrollLeft=n.scrollLeft),n&&n.scrollTop&&(e.scrollContainer.scrollTop=n.scrollTop)}},hubScrolled:function(){this.rendering.size||(this.rendering.size={width:this.scrollContainer.clientWidth,height:this.scrollContainer.clientHeight});var t=this.scrollContainer.scrollLeft||this.scrollContainer.scrollTop,e=Math.abs(t-this.rendering.lastScroll);e>this.multipassStrategy.scrollOffset&&(this.multipassStrategy.processSections(this),this.rendering.lastScroll=t)},exitPage:function(){this.savestate&&this.saveCtrlState()},pageLayout:function(){var t=this;t.layout(),t.savestate&&t.restoreCtrlState()},contentReady:function(){var t=this;t.renderItemsContent()},updateLayout:function(){var t=this,e={w:t.scrollContainer.clientWidth,h:t.scrollContainer.clientHeight};!t.LastLayoutState||t.LastLayoutState.w==e.w&&t.LastLayoutState.h==e.h||(t.scrollContainer.scrollLeft=0,t.scrollContainer.scrollTop=0),t.LastLayoutState=e},dispose:function(){var t=this;t.scrollContainer.removeEventListener("scroll",t.hubScrolledBind),WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(this.element)}})}),WinJS.Namespace.define("WinJSContrib.UI",{HubSection:WinJS.Class.define(function(t,e){var n=this;e=e||{},n.element=t||document.createElement("DIV"),n.element.winControl=n,n.element.className=n.element.className+" mcn-hub-section win-disposable",n.onlayout=e.onlayout},{layout:function(t){var e=this,n=e.element.querySelectorAll(".mcn-layout-ctrl");if(n&&n.length)for(var i=0;i<n.length;i++){var o=n[i].winControl;o&&(o.multipass=o.multipass||e.multipass,o.layout&&o.layout())}e.onlayout&&e.onlayout(t)},_attachItemsControls:function(){var t=this,e=this.element.querySelectorAll(".mcn-items-ctrl");if(e&&e.length)for(var n=0;n<e.length;n++){var i=e[n].winControl;i&&(i.multipass=t.hub.multipass,void 0==i.scrollContainer&&(i.scrollContainer=t.hub.scrollContainer))}},renderItemsContent:function(){var t=this.element.querySelectorAll(".mcn-items-ctrl");if(t&&t.length)for(var e=0;e<t.length;e++){var n=t[e].winControl;n&&n.renderItemsContent&&n.renderItemsContent()}},dispose:function(){WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(this.element)}})})}();