/* 
 * WinJS Contrib v2.1.0.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{TileMenu:WinJS.Class.mix(WinJS.Class.define(function(e,t){this.element=e||document.createElement("DIV"),t=t||{},this.items=[],this.element.winControl=this,this.element.classList.add("win-disposable"),this.element.classList.add("mcn-tilemenu"),this.element.style.display="none",this._space=10,this.offsets={left:0,top:0,right:0,bottom:0,preferred:""},WinJS.UI.setOptions(this,t)},{itemTemplate:{get:function(){return this._itemTemplate},set:function(e){this._itemTemplate=WinJSContrib.Utils.getTemplate(e)}},space:{get:function(){return this._space},set:function(e){this._space=e}},_calcOffsets:function(){var e=this;e.offsets.left=e.sourcePosition.x,e.offsets.top=e.sourcePosition.y,e.offsets.right=document.body.clientWidth-(e.sourcePosition.x+e.sourcePosition.width),e.offsets.bottom=document.body.clientHeight-(e.sourcePosition.y+e.sourcePosition.height),e.offsets.preferred="",e.offsets.left<0||e.offsets.right<0||e.offsets.top<0||e.offsets.bottom<0?e.offsets.preferred=e.offsets.left<0||e.offsets.right<0?e.offsets.right>0?"right":"left":e.offsets.top>0?"top":"bottom":e.offsets.left>e.offsets.top&&e.offsets.left>e.offsets.bottom&&e.offsets.left>e.offsets.right?e.offsets.preferred="left":e.offsets.right>e.offsets.top&&e.offsets.right>e.offsets.bottom&&e.offsets.right>e.offsets.left?e.offsets.preferred="right":e.offsets.top>e.offsets.right&&e.offsets.top>e.offsets.bottom&&e.offsets.top>e.offsets.left?e.offsets.preferred="top":e.offsets.bottom>e.offsets.right&&e.offsets.bottom>e.offsets.top&&e.offsets.bottom>e.offsets.left&&(e.offsets.preferred="bottom")},show:function(e,t){var i=this;t=t||{},i.sourcePosition=WinJSContrib.UI.offsetFrom(e),i._calcOffsets(),i._renderMenu(t.items||i.items),i.currentElements.overlay.style.opacity="0",i.currentElements.root.style.opacity="",i._layoutItems(t.placement||i.placement,t.fillmode||i.fillmode);var o=i.currentElements.items.map(function(e){return e.element}),n=[WinJSContrib.UI.Animation.fadeIn(i.currentElements.overlay,{duration:400}),WinJSContrib.UI.Animation.enterGrow(o,{duration:300,itemdelay:15,maxdelay:150,exagerated:!0,easing:WinJSContrib.UI.Animation.Easings.easeOutBack})];return WinJS.Promise.join(n)},hide:function(e){var t=this,i=t.currentElements;if(!i)return WinJS.Promise.wrap(null);t.currentElements=null,WinJSContrib.UI.untapAll(i.root);var o=i.items.map(function(e){return e.element});e&&(o=o.filter(function(t){return t!=e}));var n=[WinJSContrib.UI.Animation.fadeOut(i.overlay,{duration:160,delay:100}),WinJSContrib.UI.Animation.exitShrink(e,{duration:260,exagerated:!0,delay:140,easing:WinJSContrib.UI.Animation.Easings.easeInBack}),WinJSContrib.UI.Animation.exitShrink(o,{duration:160,exagerated:!0,itemdelay:20,maxdelay:100,easing:WinJSContrib.UI.Animation.Easings.easeInBack})];return WinJS.Promise.join(n).then(function(){i.root.parentElement.removeChild(i.root)})},_renderMenuItem:function(e,t){var i=this,o={item:t,element:null,x:0,y:0,w:0,h:0};return o.itemPromise=i.itemTemplate.render(t,o.element).then(function(n){o.element=n.children[0],o.element.classList.add("mcn-tilemenu-menu"),o.element.style.opacity="0",WinJSContrib.UI.tap(o.element,function(e){i.dispatchEvent("iteminvoked",{item:t,target:e}),i.hide(e)}),e.appendChild(o.element)}),o},_renderMenu:function(e){var t=this,i={root:null,overlay:null,itemsContainer:null,items:[]};t.currentElements=i,i.root=document.createElement("DIV"),i.root.className="mcn-tilemenu-container",i.root.style.opacity="0",i.root.id=t.name,i.overlay=document.createElement("DIV"),i.overlay.className="mcn-tilemenu-overlay",i.root.appendChild(i.overlay),t._renderOverlay(),WinJSContrib.UI.tap(i.overlay,function(){t.hide()},{disableAnimation:!0}),i.itemsContainer=document.createElement("DIV"),i.itemsContainer.className="mcn-tilemenu-items",i.root.appendChild(i.itemsContainer),WinJSContrib.UI.tap(i.itemsContainer,function(){t.hide()},{disableAnimation:!0}),e.forEach(function(e,o){i.items.push(t._renderMenuItem(i.itemsContainer,e,o))}),document.body.appendChild(i.root)},_renderOverlay:function(){var e=this,t='<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><defs><mask id="maskrect"><rect fill="white" x="0" y="0" width="100%" height="100%"></rect><rect fill="black" x="'+e.sourcePosition.x+'" y="'+e.sourcePosition.y+'" width="'+e.sourcePosition.width+'" height="'+e.sourcePosition.height+'"></rect></mask></defs><rect class="bg" x="0" y="0" width="100%" height="100%" mask="url(&quot;#maskrect&quot;)"></rect></svg>';e.currentElements.overlay.innerHTML=t},_layoutItems:function(e,t){var i=this;if(e=e||"auto",t=t||"stack","stack"==t)i._checkStack(e);else{var o=["right","bottom","left","top"];"clockwise"==t?("top"==e&&(o=["top","right","bottom","left"]),"right"==e&&(o=["right","bottom","left","top"]),"bottom"==e&&(o=["bottom","left","top","right"]),"left"==e&&(o=["left","top","right","bottom"])):"counterclockwise"==t&&("top"==e&&(o=["top","left","bottom","right"]),"right"==e&&(o=["right","top","left","bottom"]),"bottom"==e&&(o=["bottom","right","top","left"]),"left"==e&&(o=["left","bottom","right","top"])),o.current=-1,i._checkLayoutDirection(0,o)}},_checkStack:function(e){var t=this,i=function(){return t.offsets.preferred&&t.offsets.preferred.length?t.offsets.preferred:t.offsets.left>0&&t.offsets.right>0?t.offsets.top>t.offsets.bottom?"top":"bottom":t.offsets.left>t.offsets.right?"left":"right"};"auto"==e&&(e=i()),"right"==e?t._stackRight():"left"==e?t._stackLeft():"top"==e?t._stackTop():"bottom"==e&&t._stackBottom()},_checkLayoutDirection:function(e,t){var i=this;if(t.current++,!(e>=i.currentElements.items.length)){var o=t[t.current-1],n=t[t.current],s=t[t.current+1],r=i.currentElements.items[e];if("right"==n)if("bottom"==s||"top"==o){var l=i.sourcePosition.y,c=i.sourcePosition.x+i.sourcePosition.width+i._space;i._layoutToBottom(e,c,l,"left",t)}else if("top"==s||"bottom"==o){var l=i.sourcePosition.y+i.sourcePosition.height-r.element.clientHeight,c=i.sourcePosition.x+i.sourcePosition.width+i._space;i._layoutToTop(e,c,l,"left",t)}if("left"==n)if("bottom"==s||"top"==o){var l=i.sourcePosition.y,c=i.sourcePosition.x-i._space;i._layoutToBottom(e,c,l,"right",t)}else if("top"==s||"bottom"==o){var l=i.sourcePosition.y+i.sourcePosition.height-r.element.clientHeight,c=i.sourcePosition.x-i._space;i._layoutToTop(e,c,l,"right",t)}if("bottom"==n)if("left"==s||"right"==o){var l=i.sourcePosition.y+i.sourcePosition.height+i._space,c=i.sourcePosition.x+i.sourcePosition.width-r.element.clientWidth;i._layoutToLeft(e,c,l,"bottom",t)}else if("right"==s||"left"==o){var l=i.sourcePosition.y+i.sourcePosition.height+i._space,c=i.sourcePosition.x;i._layoutToRight(e,c,l,"bottom",t)}if("top"==n)if("left"==s||"right"==o){var l=i.sourcePosition.y-i._space,c=i.sourcePosition.x+i.sourcePosition.width-r.element.clientWidth;i._layoutToLeft(e,c,l,"top",t)}else if("right"==s||"left"==o){var l=i.sourcePosition.y-i._space,c=i.sourcePosition.x;i._layoutToRight(e,c,l,"top",t)}}},_layoutToBottom:function(e,t,i,o,n){for(var s=this,r=e;r<s.currentElements.items.length;r++){var l=s.currentElements.items[r];if(l.element.style.left="right"==o?t-l.element.clientWidth+"px":t+"px",l.element.style.top=i+"px",i+=l.element.clientHeight+s.space,parseInt(i,10)>parseInt(s.sourcePosition.y+s.sourcePosition.height+s.space+1,10)){s._checkLayoutDirection(r+1,n);break}}},_layoutToTop:function(e,t,i,o,n){for(var s=this,r=e;r<s.currentElements.items.length;r++){var l=s.currentElements.items[r];if(l.element.style.left="right"==o?t-l.element.clientWidth+"px":t+"px",l.element.style.top=i+"px",i-=l.element.clientHeight+s.space,parseInt(i+l.element.clientHeight+s.space+1,10)<parseInt(s.sourcePosition.y,10)){s._checkLayoutDirection(r+1,n);break}}},_layoutToRight:function(e,t,i,o,n){for(var s=this,r=e;r<s.currentElements.items.length;r++){var l=s.currentElements.items[r];if(l.element.style.left=t+"px",l.element.style.top="top"==o?i-l.element.clientHeight+"px":i+"px",t+=l.element.clientWidth+s.space,parseInt(t,10)>parseInt(s.sourcePosition.x+s.sourcePosition.width+s.space+1,10)){s._checkLayoutDirection(r+1,n);break}}},_layoutToLeft:function(e,t,i,o,n){for(var s=this,r=e;r<s.currentElements.items.length;r++){var l=s.currentElements.items[r],c=s.currentElements.items[r+1],m=0;if(c&&(m=c.element.clientWidth),l.element.style.left=t+"px",l.element.style.top="top"==o?i-l.element.clientHeight+"px":i+"px",t-=l.element.clientWidth+s.space,parseInt(t+m+s.space+1,10)<parseInt(s.sourcePosition.x,10)){s._checkLayoutDirection(r+1,n);break}}},_stackRight:function(){for(var e=this,t=e.sourcePosition.x+e.sourcePosition.width+e._space,i=e.sourcePosition.y,o=0,n=e.sourcePosition.y+e.sourcePosition.height,s=0;s<e.currentElements.items.length;s++){var r=e.currentElements.items[s],l=e.currentElements.items[s+1],c=0;l&&(c=l.element.clientHeight),r.element.style.left=t+"px",r.element.style.top=i+"px",r.element.clientWidth>o&&(o=r.element.clientWidth),i+=r.element.clientHeight+e._space,i+c>n&&(t+=o+e._space,i=e.sourcePosition.y,o=0)}},_stackLeft:function(){for(var e=this,t=e.sourcePosition.x-e._space,i=e.sourcePosition.y,o=0,n=e.sourcePosition.y+e.sourcePosition.height,s=0;s<e.currentElements.items.length;s++){var r=e.currentElements.items[s],l=e.currentElements.items[s+1],c=0;l&&(c=l.element.clientHeight),r.element.style.left=t-r.element.clientWidth+"px",r.element.style.top=i+"px",r.element.clientWidth>o&&(o=r.element.clientWidth),i+=r.element.clientHeight+e._space,i+c>n&&(t-=o+e._space,i=e.sourcePosition.y,o=0)}},_stackBottom:function(){for(var e=this,t=e.sourcePosition.x,i=e.sourcePosition.y+e.sourcePosition.height+e._space,o=0,n=e.sourcePosition.x+e.sourcePosition.width,s=0;s<e.currentElements.items.length;s++){var r=e.currentElements.items[s],l=e.currentElements.items[s+1],c=0;l&&(c=l.element.clientWidth),r.element.style.left=t+"px",r.element.style.top=i+"px",r.element.clientHeight>o&&(o=r.element.clientHeight),t+=r.element.clientWidth+e._space,t+c>n&&(t=e.sourcePosition.x,i+=o+e._space,o=0)}},_stackTop:function(){for(var e=this,t=e.sourcePosition.x,i=e.sourcePosition.y-e._space,o=0,n=e.sourcePosition.x+e.sourcePosition.width,s=0;s<e.currentElements.items.length;s++){var r=e.currentElements.items[s],l=e.currentElements.items[s+1],c=0;l&&(c=l.element.clientWidth),r.element.style.left=t+"px",r.element.style.top=i-r.element.clientHeight+"px",r.element.clientHeight>o&&(o=r.element.clientHeight),t+=r.element.clientWidth+e._space,t+c>n&&(t=e.sourcePosition.x,i-=o+e._space,o=0)}},dispose:function(){WinJS.Utilities.disposeSubTree(this.element)}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("iteminvoked"))})}();