!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{TileMenu:WinJS.Class.mix(WinJS.Class.define(function(e,t){this.element=e||document.createElement("DIV"),t=t||{},this.items=[],this.element.winControl=this,this.element.classList.add("win-disposable"),this.element.classList.add("mcn-tilemenu"),this.element.style.display="none",this._space=10,this.offsets={left:0,top:0,right:0,bottom:0,preferred:""},WinJS.UI.setOptions(this,t)},{itemTemplate:{get:function(){return this._itemTemplate},set:function(e){this._itemTemplate=WinJSContrib.Utils.getTemplate(e)}},space:{get:function(){return this._space},set:function(e){this._space=e}},_calcOffsets:function(){var e=this;e.offsets.left=e.sourcePosition.x,e.offsets.top=e.sourcePosition.y,e.offsets.right=document.body.clientWidth-(e.sourcePosition.x+e.sourcePosition.width),e.offsets.bottom=document.body.clientHeight-(e.sourcePosition.y+e.sourcePosition.height),e.offsets.preferred="",e.offsets.left<0||e.offsets.right<0||e.offsets.top<0||e.offsets.bottom<0?e.offsets.preferred=e.offsets.left<0||e.offsets.right<0?e.offsets.right>0?"right":"left":e.offsets.top>0?"top":"bottom":e.offsets.left>e.offsets.top&&e.offsets.left>e.offsets.bottom&&e.offsets.left>e.offsets.right?e.offsets.preferred="left":e.offsets.right>e.offsets.top&&e.offsets.right>e.offsets.bottom&&e.offsets.right>e.offsets.left?e.offsets.preferred="right":e.offsets.top>e.offsets.right&&e.offsets.top>e.offsets.bottom&&e.offsets.top>e.offsets.left?e.offsets.preferred="top":e.offsets.bottom>e.offsets.right&&e.offsets.bottom>e.offsets.top&&e.offsets.bottom>e.offsets.left&&(e.offsets.preferred="bottom")},show:function(e,t){var o=this;t=t||{},o.sourcePosition=WinJSContrib.UI.offsetFrom(e),o._calcOffsets(),o._renderMenu(t.items||o.items),o.currentElements.overlay.style.opacity="0",o.currentElements.root.style.opacity="",WinJSContrib.UI.Animation.fadeIn(o.currentElements.overlay,400),o._layoutItems(t.placement||o.placement,t.fillmode||o.fillmode);var i=o.currentElements.items.map(function(e){return e.element});WinJSContrib.UI.Animation.enterGrow(i,300,{itemdelay:15,maxdelay:150,exagerated:!0,easing:WinJSContrib.UI.Animation.Easings.easeOutBack})},hide:function(e){var t=this,o=t.currentElements;if(o){t.currentElements=null,$(".tap",o.root).untap();var i=o.items.map(function(e){return e.element});if(e)var i=i.filter(function(t){return t!=e});var s=[];s.push(WinJSContrib.UI.Animation.fadeOut(o.overlay,160,{delay:100})),s.push(WinJSContrib.UI.Animation.exitShrink(e,260,{exagerated:!0,delay:140,easing:WinJSContrib.UI.Animation.Easings.easeInBack})),s.push(WinJSContrib.UI.Animation.exitShrink(i,160,{exagerated:!0,itemdelay:20,maxdelay:100,easing:WinJSContrib.UI.Animation.Easings.easeInBack})),WinJS.Promise.join(s).then(function(){$(o.root).remove()})}},_renderMenuItem:function(e,t){var o=this,i={item:t,element:null,x:0,y:0,w:0,h:0};return i.itemPromise=o.itemTemplate.render(t,i.element).then(function(s){i.element=s.children[0],i.element.classList.add("mcn-tilemenu-menu"),i.element.style.opacity="0",$(i.element).tap(function(e){o.dispatchEvent("iteminvoked",{item:t,target:e}),o.hide(e)}),e.appendChild(i.element)}),i},_renderMenu:function(e){var t=this,o={root:null,overlay:null,itemsContainer:null,items:[]};t.currentElements=o,o.root=document.createElement("DIV"),o.root.className="mcn-tilemenu-container",o.root.style.opacity="0",o.root.id=t.name,o.overlay=document.createElement("DIV"),o.overlay.className="mcn-tilemenu-overlay",o.root.appendChild(o.overlay),t._renderOverlay(),$(o.overlay).tap(function(){t.hide()},{disableAnimation:!0}),o.itemsContainer=document.createElement("DIV"),o.itemsContainer.className="mcn-tilemenu-items",o.root.appendChild(o.itemsContainer),$(o.itemsContainer).tap(function(){t.hide()},{disableAnimation:!0}),e.forEach(function(e,i){o.items.push(t._renderMenuItem(o.itemsContainer,e,i))}),document.body.appendChild(o.root)},_renderOverlay:function(){var e=this,t='<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><defs><mask id="maskrect"><rect fill="white" x="0" y="0" width="100%" height="100%"></rect><rect fill="black" x="'+e.sourcePosition.x+'" y="'+e.sourcePosition.y+'" width="'+e.sourcePosition.width+'" height="'+e.sourcePosition.height+'"></rect></mask></defs><rect class="bg" x="0" y="0" width="100%" height="100%" mask="url(&quot;#maskrect&quot;)"></rect></svg>';e.currentElements.overlay.innerHTML=t},_layoutItems:function(e,t){var o=this;if(e=e||"auto",t=t||"stack","stack"==t)o._checkStack(e);else{var i=["right","bottom","left","top"];"clockwise"==t?("top"==e&&(i=["top","right","bottom","left"]),"right"==e&&(i=["right","bottom","left","top"]),"bottom"==e&&(i=["bottom","left","top","right"]),"left"==e&&(i=["left","top","right","bottom"])):"counterclockwise"==t&&("top"==e&&(i=["top","left","bottom","right"]),"right"==e&&(i=["right","top","left","bottom"]),"bottom"==e&&(i=["bottom","right","top","left"]),"left"==e&&(i=["left","bottom","right","top"])),i.current=-1,o._checkLayoutDirection(0,i)}},_checkStack:function(e){var t=this,o=function(){return t.offsets.preferred&&t.offsets.preferred.length?t.offsets.preferred:t.offsets.left>0&&t.offsets.right>0?t.offsets.top>t.offsets.bottom?"top":"bottom":t.offsets.left>t.offsets.right?"left":"right"};"auto"==e&&(e=o()),"right"==e?t._stackRight():"left"==e?t._stackLeft():"top"==e?t._stackTop():"bottom"==e&&t._stackBottom()},_checkLayoutDirection:function(e,t){var o=this;if(t.current++,!(e>=o.currentElements.items.length)){var i=t[t.current-1],s=t[t.current],n=t[t.current+1],r=o.currentElements.items[e];if("right"==s)if("bottom"==n||"top"==i){var l=o.sourcePosition.y,c=o.sourcePosition.x+o.sourcePosition.width+o._space;o._layoutToBottom(e,c,l,"left",t)}else if("top"==n||"bottom"==i){var l=o.sourcePosition.y+o.sourcePosition.height-r.element.clientHeight,c=o.sourcePosition.x+o.sourcePosition.width+o._space;o._layoutToTop(e,c,l,"left",t)}if("left"==s)if("bottom"==n||"top"==i){var l=o.sourcePosition.y,c=o.sourcePosition.x-o._space;o._layoutToBottom(e,c,l,"right",t)}else if("top"==n||"bottom"==i){var l=o.sourcePosition.y+o.sourcePosition.height-r.element.clientHeight,c=o.sourcePosition.x-o._space;o._layoutToTop(e,c,l,"right",t)}if("bottom"==s)if("left"==n||"right"==i){var l=o.sourcePosition.y+o.sourcePosition.height+o._space,c=o.sourcePosition.x+o.sourcePosition.width-r.element.clientWidth;o._layoutToLeft(e,c,l,"bottom",t)}else if("right"==n||"left"==i){var l=o.sourcePosition.y+o.sourcePosition.height+o._space,c=o.sourcePosition.x;o._layoutToRight(e,c,l,"bottom",t)}if("top"==s)if("left"==n||"right"==i){var l=o.sourcePosition.y-o._space,c=o.sourcePosition.x+o.sourcePosition.width-r.element.clientWidth;o._layoutToLeft(e,c,l,"top",t)}else if("right"==n||"left"==i){var l=o.sourcePosition.y-o._space,c=o.sourcePosition.x;o._layoutToRight(e,c,l,"top",t)}}},_layoutToBottom:function(e,t,o,i,s){for(var n=this,r=e;r<n.currentElements.items.length;r++){var l=n.currentElements.items[r];if(l.element.style.left="right"==i?t-l.element.clientWidth+"px":t+"px",l.element.style.top=o+"px",o+=l.element.clientHeight+n.space,parseInt(o,10)>parseInt(n.sourcePosition.y+n.sourcePosition.height+n.space+1,10)){n._checkLayoutDirection(r+1,s);break}}},_layoutToTop:function(e,t,o,i,s){for(var n=this,r=e;r<n.currentElements.items.length;r++){var l=n.currentElements.items[r];if(l.element.style.left="right"==i?t-l.element.clientWidth+"px":t+"px",l.element.style.top=o+"px",o-=l.element.clientHeight+n.space,parseInt(o+l.element.clientHeight+n.space+1,10)<parseInt(n.sourcePosition.y,10)){n._checkLayoutDirection(r+1,s);break}}},_layoutToRight:function(e,t,o,i,s){for(var n=this,r=e;r<n.currentElements.items.length;r++){var l=n.currentElements.items[r];if(l.element.style.left=t+"px",l.element.style.top="top"==i?o-l.element.clientHeight+"px":o+"px",t+=l.element.clientWidth+n.space,parseInt(t,10)>parseInt(n.sourcePosition.x+n.sourcePosition.width+n.space+1,10)){n._checkLayoutDirection(r+1,s);break}}},_layoutToLeft:function(e,t,o,i,s){for(var n=this,r=e;r<n.currentElements.items.length;r++){var l=n.currentElements.items[r],c=n.currentElements.items[r+1],m=0;if(c&&(m=c.element.clientWidth),l.element.style.left=t+"px",l.element.style.top="top"==i?o-l.element.clientHeight+"px":o+"px",t-=l.element.clientWidth+n.space,parseInt(t+m+n.space+1,10)<parseInt(n.sourcePosition.x,10)){n._checkLayoutDirection(r+1,s);break}}},_stackRight:function(){for(var e=this,t=e.sourcePosition.x+e.sourcePosition.width+e._space,o=e.sourcePosition.y,i=0,s=e.sourcePosition.y+e.sourcePosition.height,n=0;n<e.currentElements.items.length;n++){var r=e.currentElements.items[n],l=e.currentElements.items[n+1],c=0;l&&(c=l.element.clientHeight),r.element.style.left=t+"px",r.element.style.top=o+"px",r.element.clientWidth>i&&(i=r.element.clientWidth),o+=r.element.clientHeight+e._space,o+c>s&&(t+=i+e._space,o=e.sourcePosition.y,i=0)}},_stackLeft:function(){for(var e=this,t=e.sourcePosition.x-e._space,o=e.sourcePosition.y,i=0,s=e.sourcePosition.y+e.sourcePosition.height,n=0;n<e.currentElements.items.length;n++){var r=e.currentElements.items[n],l=e.currentElements.items[n+1],c=0;l&&(c=l.element.clientHeight),r.element.style.left=t-r.element.clientWidth+"px",r.element.style.top=o+"px",r.element.clientWidth>i&&(i=r.element.clientWidth),o+=r.element.clientHeight+e._space,o+c>s&&(t-=i+e._space,o=e.sourcePosition.y,i=0)}},_stackBottom:function(){for(var e=this,t=e.sourcePosition.x,o=e.sourcePosition.y+e.sourcePosition.height+e._space,i=0,s=e.sourcePosition.x+e.sourcePosition.width,n=0;n<e.currentElements.items.length;n++){var r=e.currentElements.items[n],l=e.currentElements.items[n+1],c=0;l&&(c=l.element.clientWidth),r.element.style.left=t+"px",r.element.style.top=o+"px",r.element.clientHeight>i&&(i=r.element.clientHeight),t+=r.element.clientWidth+e._space,t+c>s&&(t=e.sourcePosition.x,o+=i+e._space,i=0)}},_stackTop:function(){for(var e=this,t=e.sourcePosition.x,o=e.sourcePosition.y-e._space,i=0,s=e.sourcePosition.x+e.sourcePosition.width,n=0;n<e.currentElements.items.length;n++){var r=e.currentElements.items[n],l=e.currentElements.items[n+1],c=0;l&&(c=l.element.clientWidth),r.element.style.left=t+"px",r.element.style.top=o-r.element.clientHeight+"px",r.element.clientHeight>i&&(i=r.element.clientHeight),t+=r.element.clientWidth+e._space,t+c>s&&(t=e.sourcePosition.x,o-=i+e._space,i=0)}},dispose:function(){WinJS.Utilities.disposeSubTree(this.element)}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("iteminvoked"))})}();