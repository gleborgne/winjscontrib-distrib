/* 
 * WinJS Contrib v2.1.0.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";function n(n){return n=n.replace(/[^\w\s]/gi,""),/^\d/.test(n)&&(n=n.replace(/\s+/g,""),n="mcn"+n),n}WinJS.Namespace.define("WinJSContrib.DataContainer",{CordovaDatabaseContainer:WinJS.Class.define(function(n,t,e){this.key=n||"mcndatacontainer",this.options=t,this.parent=e,this.storageKey=e?e.storageKey+"."+this.key:this.key},{read:function(t){var e=this,i=openDatabase("survey","1.0","database",2e6);return console.log("trying to read "+t),new WinJS.Promise(function(a){i.transaction(function(i){i.executeSql("SELECT * FROM "+n(e.key)+" WHERE itemkey=?",[t],function(n,t){if(t.rows&&t.rows.length){var e=JSON.parse(t.rows.item(0).data);a(e)}else a(null)},function(){a(null)})},function(){a(null)})})},save:function(t,e){var i=this,a=openDatabase("survey","1.0","database",2e6);return new WinJS.Promise(function(o,s){if(e){var r=JSON.stringify(e);a.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+n(i.key)+"(itemkey TEXT PRIMARY KEY, data)")},function(){s()},function(){a.transaction(function(e){e.executeSql("INSERT OR REPLACE INTO "+n(i.key)+"(itemkey, data) VALUES (?,?)",[t,r],function(){o()},function(){s()})},function(){s()})})}})},remove:function(t){var e=this,i=openDatabase("survey","1.0","database",2e6);return new WinJS.Promise(function(a,o){i.transaction(function(i){i.executeSql("DELETE FROM "+n(e.key)+" WHERE itemkey=?",[t],function(){a()},function(){o()})})})},list:function(){var t=this,e=openDatabase("survey","1.0","database",2e6);return new WinJS.Promise(function(i){e.transaction(function(e){e.executeSql("SELECT * FROM "+n(t.key),[],function(n,t){if(t.rows&&t.rows.length){for(var e=[],a=0;a<t.rows.length;a++){var o=t.rows.item(a);e.push({displayName:o.itemkey})}i(e)}else i([])},function(){i([])})})})},child:function(n){if(this[n])return this[n];console.log("getting child");var t=new WinJSContrib.DataContainer.CordovaDatabaseContainer(n,this.options,this);return this[n]=t,t}})})}();