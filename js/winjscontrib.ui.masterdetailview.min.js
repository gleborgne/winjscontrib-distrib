/* 
 * WinJS Contrib v2.0.3.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{MasterDetailView:WinJS.Class.mix(WinJS.Class.define(function(e,t){this.element=e||document.createElement("DIV"),t=t||{},t.orientation=t.orientation||"horizontal",t.headerBehavior=t.headerBehavior||"back",this.element.winControl=this,this.element.classList.add("win-disposable"),this.element.classList.add("mcn-layout-ctrl"),this.element.classList.add("mcn-navigation-ctrl"),this.element.classList.add("mcn-masterdetailview"),this._initContent(),this.uriArgs=t.uriArgs,WinJS.UI.setOptions(this,t),this.mediaTrigger&&this.mediaTrigger.check()},{orientation:{get:function(){return this._orientation},set:function(e){this._orientation=e,this.element.classList.remove("mcn-vertical"),this.element.classList.remove("mcn-horizontal"),("vertical"==e||"horizontal"==e)&&this.element.classList.add("mcn-"+e)}},orientations:{get:function(){return this._orientations},set:function(e){this._orientations=e,this.mediaTrigger&&(this.mediaTrigger.dispose(),this.mediaTrigger=null),e&&(this.mediaTrigger=new WinJSContrib.UI.MediaTrigger(e,this))}},uri:{get:function(){return this._uri},set:function(e){var t=this;t._uri=e,t.masterViewContent&&$(t.masterViewContent.element).remove(),t.loading&&t.loading.cancel(),t.loading=WinJSContrib.UI.Pages.renderFragment(t.masterView,e,t.uriArgs,{parented:WinJS.Promise.timeout(),oncreate:function(e){var i=e.winControl;i.masterDetailView=t,t.masterViewContent=i}})}},_initContent:function(){var e=this;e.masterView=document.createElement("DIV"),e.masterView.className="mcn-masterdetailview-master visible",WinJSContrib.Utils.moveChilds(e.element,e.masterView),e.element.appendChild(e.masterView),e.detailView=document.createElement("DIV"),e.detailView.className="mcn-masterdetailview-detail",e.element.appendChild(e.detailView),e.detailViewHeader=document.createElement("DIV"),e.detailViewHeader.className="mcn-masterdetailview-detail-header",e.detailView.appendChild(e.detailViewHeader),e.detailViewContent=document.createElement("DIV"),e.detailViewContent.className="mcn-masterdetailview-detail-content",e.detailView.appendChild(e.detailViewContent)},_defaultHeaderTemplate:function(){return{render:function(e,t){return new WinJS.Promise(function(i){var n=document.createElement("DIV");n.className="mcn-masterdetailview-defaultheader";var a=document.createElement("DIV");a.className="back",n.appendChild(a);var r=document.createElement("DIV");r.className="title",e&&(r.innerText=e.title),n.appendChild(r),t&&t.appendChild(n),i(n)})}}},_renderDetailHeader:function(e,t){var i=this;i.detailViewHeader.innerHTML="";var n=i.headerTemplate||i._defaultHeaderTemplate();return n.render(e,i.detailViewHeader).then(function(e){return t&&t.prepareHeader&&t.prepareHeader({header:i.detailViewHeader}),"back"==i.headerBehavior&&$(e).tap(function(){i.returnToMaster()}),e})},_clearDetailContent:function(){var e=this;if(e.loading&&(e.loading.cancel(),e.loading=null),e.detailViewContentCtrl){var t=e.detailViewContentCtrl.element;e.detailViewContentCtrl.unload&&e.detailViewContentCtrl.unload(),e.detailViewContentCtrl.dispose&&e.detailViewContentCtrl.dispose(),$(t).remove(),e.detailViewContentCtrl=null}e.detailViewContent.innerHTML=""},_loadDetailContent:function(e,t,i){var n=this;if(n._clearDetailContent(),i.wrapInMasterDetailView){var a=document.createElement("DIV");return a.style.width="100%",a.style.height="100%",n.detailViewContentCtrl=new WinJSContrib.UI.MasterDetailView(a,{uri:e,uriArgs:t,parent:n,orientation:n.orientation,orientations:n.orientations}),n.detailViewContent.appendChild(a),WinJS.Promise.wrap()}return WinJSContrib.UI.Pages.renderFragment(n.detailViewContent,e,t,{oncreate:function(e){var t=e.winControl;t.masterDetailView=n,n.detailViewContentCtrl=t}})},_animateToDetail:function(e,t,i){var n=this,a=WinJSContrib.UI.Morph.from(e);return n.morph=a,n.detailViewContent.style.opacity="0",n.detailViewContent.style.display="none",a.fadeIn({duration:100}).then(function(){a.morphToElt(n.detailViewHeader),n.detailViewHeader.style.opacity="0",n.detailViewContent.style.display="",n.detailView.classList.add("visible"),WinJSContrib.UI.Animation.fadeOut(n.masterView,{duration:100}).then(function(){n.masterView.style.opacity="",n.masterView.classList.remove("visible")}).then(function(){return a.apply({duration:350}).then(function(){return n._loadDetailContent(i.uri,t,i)}).then(function(){return WinJSContrib.UI.Animation.enterPage(n.detailViewContent,{duration:700}),n.detailViewHeader.style.opacity="",a.fadeOut({duration:200})})})})},_animateToMaster:function(){var e=this,t=e.morph;return e.morph=null,t?(t.checkTarget(!0),t.fadeIn({duration:160}),WinJSContrib.UI.Animation.fadeOut(e.detailView,{duration:250}).then(function(){e.detailView.classList.remove("visible"),e.detailView.style.display="none"}).then(function(){return e.masterView.classList.add("visible"),e.masterView.style.opacity="0",t.revert({duration:250})}).then(function(){return WinJSContrib.UI.Animation.fadeIn(e.masterView,{duration:300,easing:"ease-in"})}).then(function(){return t.fadeOut({duration:160})}).then(function(){e.detailView.style.display="",e.detailView.style.opacity="",e._clearDetailContent(),t.dispose()})):void 0},openDetail:function(e,t,i){var n=this;return n._renderDetailHeader(t,i).then(function(){return n._animateToDetail(e,t,i)}).then(function(){n.navEventsHandler=WinJSContrib.UI.registerNavigationEvents(n,n.returnToMaster)})},returnToMaster:function(e){var t=this;e&&(e.handled=!0),t.navEventsHandler&&(t.navEventsHandler(),t.navEventsHandler=null),t._animateToMaster().then(function(){t._clearDetailContent()})},dispose:function(){this.mediaTrigger&&(this.mediaTrigger.dispose(),this.mediaTrigger=null),this._clearDetailContent(),WinJS.Utilities.disposeSubTree(this.element)},updateLayout:function(e){var t=this;t.masterViewContent&&t.masterViewContent.updateLayout&&t.masterViewContent.updateLayout(e),t.detailViewContentCtrl&&t.detailViewContentCtrl.updateLayout&&t.detailViewContentCtrl.updateLayout(e)}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("myevent"))})}();