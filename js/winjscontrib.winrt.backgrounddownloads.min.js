/* 
 * WinJS Contrib v2.0.1.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var WinJSContrib=WinJSContrib||{};!function(){function n(){return new WinJS.Promise(function(n){Windows.Networking.BackgroundTransfer.BackgroundDownloader.getCurrentDownloadsAsync().then(function(o){for(var r=new WinJS.Binding.List,e=0;e<o.size;e++){var a=new WinJSContrib.BgDownloads.Download;a.load(o[e]),r.push(a)}WinJSContrib.BgDownloads.currentDownloads=r,n(r)},function(){var o=new WinJS.Binding.List;WinJSContrib.BgDownloads.currentDownloads=o,n(o)})})}function o(){return new WinJS.Promise(function(n){Windows.Networking.BackgroundTransfer.BackgroundUploader.getCurrentUploadsAsync().then(function(o){for(var r=new WinJS.Binding.List,e=0;e<o.size;e++){var a=new WinJSContrib.BgDownloads.Upload;a.load(o[e]),r.push(a)}WinJSContrib.BgDownloads.currentUploads=r,n(r)},function(){var o=new WinJS.Binding.List;WinJSContrib.BgDownloads.currentUploads=o,n(o)})})}function r(n){console.log(n)}WinJSContrib.BgDownloads=WinJSContrib.BgDownloads||{},WinJSContrib.BgDownloads.currentDownloads=new WinJS.Binding.List,WinJSContrib.BgDownloads.initDownloads=n,WinJSContrib.BgDownloads.initUploads=o,WinJSContrib.BgDownloads.init=function(){return WinJS.Promise.join([n(),o()])},WinJSContrib.BgDownloads.Download=WinJS.Class.mix(WinJS.Class.define(function(){this._initObservable(),this.progress=0,this.download=null,this.promise=null,this.imageStream=null,this.oncomplete=null,this.onerror=null,this._completeCallbackBinded=this._completeCallback.bind(this),this._progressCallbackBinded=this._progressCallback.bind(this),this._errorCallbackBinded=this._errorCallback.bind(this)},{start:function(n,o,e,a,i,d){var l=this;return"string"==typeof n&&(n=new Windows.Foundation.Uri(n)),e=e||Windows.Storage.ApplicationData.current.localFolder,i=i||Windows.Networking.BackgroundTransfer.BackgroundTransferPriority["default"],a=a||Windows.Storage.CreationCollisionOption.failIfExists,new WinJS.Promise(function(t,s){var u=function(n){l._errorCallback(n),s(n)};e.createFileAsync(o,a).then(function(o){var e=new Windows.Networking.BackgroundTransfer.BackgroundDownloader;return r("bg download using URI: "+n.absoluteUri),l.download=e.createDownload(n,o),l.download.priority=i,WinJSContrib.BgDownloads.currentDownloads.push(l),l.file=l.download.resultFile.path,l.progress=0,d?Windows.Networking.BackgroundTransfer.BackgroundDownloader.requestUnconstrainedDownloadsAsync([l.download]).then(function(n){r("Request for unconstrained downloads has been "+(n.isUnconstrained?"granted":"denied")),l.promise=l.download.startAsync().then(l._completeCallbackBinded,l._errorCallbackBinded,l._progressCallbackBinded),t(l)},u):(l.promise=l.download.startAsync().then(l._completeCallbackBinded,l._errorCallbackBinded,l._progressCallbackBinded),void t(l))},u)})},load:function(n){var o=this;o.download=n,r("Found download: "+o.download.guid+" from previous application run."),o.promise=o.download.attachAsync().then(o._completeCallbackBinded,o._errorCallbackBinded,o._progressCallbackBinded),o.file=o.download.resultFile.path,o.progress=0},cancel:function(){var n=this;n.promise?(n.promise.cancel(),n.promise=null,r("Canceling download: "+n.download.guid)):r("Download "+n.download.guid+" already canceled.")},resume:function(){var n=this;n.download&&(download.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.pausedByApplication?(n.download.resume(),r("Resuming download: "+n.download.guid)):r("Download "+n.download.guid+" is not paused, it may be running, completed, canceled or in error."))},pause:function(){var n=this;n.download&&(n.download.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.running?(n.download.pause(),r("Pausing download: "+n.download.guid)):r("Download "+n.download.guid+" is not running, it may be paused, completed, canceled or in error."))},hasGuid:function(n){var o=this;return o.download.guid===n},removeDownload:function(n){WinJSContrib.BgDownloads.currentDownloads&&WinJSContrib.BgDownloads.currentDownloads.forEach(function(o,r){o.hasGuid(n)&&WinJSContrib.BgDownloads.currentDownloads.splice(r,1)})},_progressCallback:function(){var n=this;n.progress=100*n.download.progress.bytesReceived/n.download.progress.totalBytesToReceive<<0,n.onprogress&&n.onprogress(n.progress)},_completeCallback:function(){var n=this;if(n.ended=!0,n.download&&n.download.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.completed?n.oncomplete?(n.oncomplete(),n.oncomplete=null,n.onerror=null):n.notify("complete"):n._errorCallback("transfert problem"),n.download){try{var o=n.download.getResponseInformation();r(n.download.guid+" - download complete. Status code: "+o.statusCode),WinJS.Application.queueEvent({type:"McnBgDownload",error:!1,id:n.download.guid})}catch(e){r(e)}n.removeDownload(n.download.guid)}},_errorCallback:function(n){var o=this;o.ended=!0,o.download&&(o.download.resultFile.deleteAsync().done(function(){},function(){}),o.removeDownload(o.download.guid),WinJS.Application.queueEvent({type:"McnBgDownload",error:!0,id:o.download.guid}),r(o.download.guid+" - download completed with error.")),o.onerror?(o.onerror(n),o.onerror=null):o.notify("error"),r(n)}}),WinJS.Binding.mixin,WinJS.Binding.expandProperties({progress:0})),WinJSContrib.BgDownloads.Download.run=function(n,o,r,e,a,i){var d=null;return WinJSContrib.BgDownloads.currentDownloads.forEach(function(o){o.download.requestedUri.toString()==n.toString()&&(d=o)}),d?WinJS.Promise.wrap(d):(d=new WinJSContrib.BgDownloads.Download,d.start(n,o,r,e,a,i).then(function(){return d}))},WinJSContrib.BgDownloads.Upload=WinJS.Class.mix(WinJS.Class.define(function(){this._initObservable(),this.progress=0,this.download=null,this.promise=null,this.imageStream=null,this.oncomplete=null,this.onerror=null,this._completeCallbackBinded=this._completeCallback.bind(this),this._progressCallbackBinded=this._progressCallback.bind(this),this._errorCallbackBinded=this._errorCallback.bind(this)},{start:function(n,o,e,a){var i=this;return e=e||Windows.Networking.BackgroundTransfer.BackgroundTransferPriority["default"],new WinJS.Promise(function(d,l){var t=function(n){i._errorCallback(n),l(n)},s=new Windows.Networking.BackgroundTransfer.BackgroundUploader;return r("bg upload using URI: "+n.absoluteUri),i.upload=s.createUpload(n,o),i.upload.priority=e,WinJSContrib.BgDownloads.currentUploads.push(i),i.file=i.upload.sourceFile.path,i.progress=0,a?Windows.Networking.BackgroundTransfer.BackgroundUploader.requestUnconstrainedUploadsAsync([i.upload]).then(function(n){r("Request for unconstrained uploads has been "+(n.isUnconstrained?"granted":"denied")),i.promise=i.upload.startAsync().then(i._completeCallbackBinded,i._errorCallbackBinded,i._progressCallbackBinded),d(i)},t):(i.promise=i.upload.startAsync().then(i._completeCallbackBinded,i._errorCallbackBinded,i._progressCallbackBinded),void d(i))})},load:function(n){var o=this;o.upload=n,r("Found upload: "+o.upload.guid+" from previous application run."),o.promise=o.upload.attachAsync().then(o._completeCallbackBinded,o._errorCallbackBinded,o._progressCallbackBinded),o.file=o.upload.sourceFile.path,o.progress=0},cancel:function(){var n=this;n.promise?(n.promise.cancel(),n.promise=null,r("Canceling upload: "+n.upload.guid)):r("upload "+n.upload.guid+" already canceled.")},resume:function(){var n=this;n.upload&&(n.upload.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.pausedByApplication?(n.upload.resume(),r("Resuming upload: "+n.upload.guid)):r("upload "+n.upload.guid+" is not paused, it may be running, completed, canceled or in error."))},pause:function(){var n=this;n.upload&&(n.upload.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.running?(n.upload.pause(),r("Pausing upload: "+n.upload.guid)):r("upload "+n.upload.guid+" is not running, it may be paused, completed, canceled or in error."))},hasGuid:function(n){var o=this;return o.upload.guid===n},removeUpload:function(n){WinJSContrib.BgDownloads.currentUploads&&WinJSContrib.BgDownloads.currentUploads.forEach(function(o,r){o.hasGuid(n)&&WinJSContrib.BgDownloads.currentUploads.splice(r,1)})},_progressCallback:function(){var n=this;n.progress=100*n.upload.progress.bytesSended/n.upload.progress.totalBytesToSend<<0},_completeCallback:function(){var n=this;if(n.ended=!0,n.upload&&n.upload.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.completed?n.oncomplete?(n.oncomplete(),n.oncomplete=null,n.onerror=null):n.notify("complete"):n._errorCallback("transfert problem"),n.upload){try{var o=n.upload.getResponseInformation();r(n.upload.guid+" - upload complete. Status code: "+o.statusCode)}catch(e){r(e)}n.removeUpload(n.upload.guid)}},_errorCallback:function(n){var o=this;o.ended=!0,o.upload&&(o.removeUpload(o.upload.guid),r(o.upload.guid+" - upload completed with error.")),o.onerror?(o.onerror(n),o.onerror=null):o.notify("error"),r(n)}}),WinJS.Binding.mixin,WinJS.Binding.expandProperties({progress:0})),WinJSContrib.BgDownloads.Upload.run=function(n,o,r,e){var a=null;return WinJSContrib.BgDownloads.currentUploads.forEach(function(o){o.upload.requestedUri.toString()==n.toString()&&(a=o)}),a?WinJS.Promise.wrap(a):(a=new WinJSContrib.BgDownloads.Upload,a.start(n,o,r,e).then(function(){return a}))}}();