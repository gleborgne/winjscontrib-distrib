!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{GridControl:WinJS.Class.define(function(e,t){var i=this;t=t||{},i.element=e,i.$element=$(i.element),i.element.className=i.element.className+" mcn-grid-ctrl mcn-layout-ctrl win-disposable",i.element.winControl=i,i.autolayout=t.autolayout,i.renderer=new WinJSContrib.UI.MultiPassRenderer(i.element,{multipass:t.multipass,itemClassName:t.itemClassName,itemTemplate:t.itemTemplate,itemInvoked:t.itemInvoked}),i.gridLayouts=t.layouts,i.defaultLayout={layout:"horizontal",itemsPerColumn:t.itemsPerColumn?t.itemsPerColumn:void 0,itemsPerRow:t.itemsPerRow?t.itemsPerRow:void 0,cellSpace:t.cellSpace?t.cellSpace:10,cellWidth:t.cellWidth?t.cellWidth:void 0,cellHeight:t.cellHeight?t.cellHeight:void 0}},{scrollContainer:{get:function(){return this.renderer.scrollContainer},set:function(e){this.renderer.scrollContainer=e}},prepareItems:function(e,t){var i=WinJSContrib.Utils.getParentControlByClass("mcn-layout-ctrl",this.element);!this.renderer.multipass&&i&&i.multipass&&(this.renderer.multipass=i.multipass),this.renderer.prepareItems(e,t)},pageLayout:function(){this.autolayout&&this.layout()},renderItemsContent:function(){this.renderer.renderItemsContent()},clear:function(){var e=this;e.$element.css("position","").css("display","").css("width","").css("height",""),e.$element.children().each(function(){$(this).css("position","").css("left","").css("top","").css("width","").css("height","")})},fill:function(e,t,i,l,a){if(e.length<t+l)for(var n=e.length;t+l>n;n++)e.push([]);for(var n=t;t+l>n;n++){var r=e[n];if(r.length<i+a)for(var s=r.length;i+a>s;s++)r.push(!1);for(var s=i;i+a>s;s++)r[s]=!0}},fit:function(e,t,i,l,a,n,r){if(r&&a>r&&0===i)return!0;if(n&&l>n&&0===t)return!0;if(n&&t+l>n)return!1;if(r&&i+a>r)return!1;for(var s=t;t+l>s;s++){var o=e[s];if(o)for(var c=i;i+a>c;c++)if(o[c]===!0)return!1}return!0},firstFit:function(e,t,i,l,a){for(var n=this,r=0;a*l*2>r;r++){var s=e[r];if(!s)return{x:r,y:0};for(var o=0;l>o;o++)if(s[o]!==!0&&n.fit(e,r,o,t,i,void 0,l))return{x:r,y:o}}return void 0},flexhorizontallayout:function(){var e=this;e.renderer.orientation="horizontal",e.element.style.position="relative",e.element.style.display="flex",e.element.style.flexFlow="column wrap",e.element.style.width="",e.element.style.height=e.element.clientHeight?e.element.clientHeight+"px":""},flexverticallayout:function(){var e=this;e.renderer.orientation="vertical",e.element.style.position="relative",e.element.style.display="flex",e.element.style.flexFlow="row wrap",e.element.style.width=e.element.clientWidth?e.element.clientWidth+"px":"",e.element.style.height=""},horizontallayout:function(){var e=this;e.renderer.orientation="horizontal",e.element.style.position="relative",e.element.style.height="";var t=e.element.clientHeight,i=Math.floor(t/(e.data.cellHeight+e.data.cellSpace));0>=i&&(i=1);var l=e.data.cellWidth,a=e.data.cellHeight,n=e.data.cellSpace,r=1,s=1;e.data.itemsPerColumn&&(i=e.data.itemsPerColumn,a=(t-(i-1)*n)/i>>0,l=e.data.cellWidth*a/e.data.cellHeight>>0,r=l/e.data.cellWidth,s=a/e.data.cellHeight);var o=[[]],c=e.$element.children();c.each(function(){var t=this;if("none"!=t.style.display){t.style.position="absolute";var c=$(this),d=$(this).outerWidth()*r,h=$(this).outerHeight()*s,u=d/l>>0,m=h/a>>0,f=e.firstFit(o,u,m,i,e.element.children.length);f||(f={x:0,y:0}),e.fill(o,f.x,f.y,u,m);var y=f.x*(l+n),p=f.y*(a+n);c.css("left",y+"px"),c.css("top",p+"px"),c.css("width",u*l+(u-1)*n+"px"),c.css("height",m*a+(m-1)*n+"px")}});var d=o.length*(l+n);e.$element.css("width",d+"px")},verticallayout:function(){var e=this;e.renderer.orientation="vertical",e.element.style.width="",e.element.style.position="relative";var t=e.element.clientWidth,i=Math.floor(t/(e.data.cellWidth+e.data.cellSpace));0>=i&&(i=1);var l=e.data.cellWidth,a=e.data.cellHeight,n=e.data.cellSpace,r=1,s=1;e.data.itemsPerRow&&(i=e.data.itemsPerRow,l=(t-(i-1)*n)/i>>0,a=e.data.cellHeight*l/e.data.cellWidth>>0,r=l/e.data.cellWidth,s=a/e.data.cellHeight);var o=[[]];e.$element.children().each(function(){var t=this;if("none"!=t.style.display){t.style.position="absolute";var c=$(this),d=$(this).outerWidth()*r,h=$(this).outerHeight()*s,u=d/l>>0,m=h/a>>0,f=e.firstFit(o,m,u,i,e.element.children.length);e.fill(o,f.x,f.y,m,u);var y=f.y*(l+n),p=f.x*(a+n);c.css("left",y+"px"),c.css("top",p+"px"),c.css("width",u*l+(u-1)*n+"px"),c.css("height",m*a+(m-1)*n+"px")}});var c=o.length*(a+n);e.$element.css("height",c+"px")},layout:function(){{var e=this;e.data}if(e.data=e.getLayout(),e.data){if(e.data.cellSpace=e.data.cellSpace||e.defaultLayout.cellSpace||10,e.data.cellWidth=e.data.cellWidth||e.defaultLayout.cellWidth||0,e.data.cellHeight=e.data.cellHeight||e.defaultLayout.cellHeight||0,(!e.data.cellWidth||!e.data.cellHeight)&&e.element.childNodes&&e.element.children.length>0){var t=e.element.children[e.element.children.length-1],i=$(t);e.data.cellWidth=i.outerWidth(),e.data.cellHeight=i.outerHeight()}var l=e[e.data.layout+"layout"];l&&(l.bind(e)(),e.data.applyed=!0),e.renderer.checkRendering()}},updateLayout:function(){var e=this;e.clear(),e.renderer.updateLayout(),setImmediate(function(){e.layout()})},getLayout:function(){var e=this,t=void 0;if(e.gridLayouts)for(var i in e.gridLayouts){var l=e.gridLayouts[i];if(e.gridLayouts.hasOwnProperty(i))if(l.query){var a=window.matchMedia(l.query);a.matches&&(t=l)}else t||(t=l);else t||(t=l)}return t||(t=e.defaultLayout),JSON.parse(JSON.stringify(t))},dispose:function(){WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(this.element)}})})}();