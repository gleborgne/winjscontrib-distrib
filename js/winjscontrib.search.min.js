var WinJSContrib=WinJSContrib||{};WinJSContrib.Search=WinJSContrib.Search||{},function(){"use strict";function e(e,n,r,t){return new WinJS.Promise(function(i,o){e.createFileAsync(n,r).done(function(e){Windows.Storage.FileIO.writeTextAsync(e,JSON.stringify(t)).done(function(){WinJS&&WinJS.log&&WinJS.log("File written "+e.path),i()},o)},o)})}function n(e,n){return new WinJS.Promise(function(r,t){e.createFileAsync(n,Windows.Storage.CreationCollisionOption.openIfExists).then(function(e){Windows.Storage.FileIO.readTextAsync(e).done(function(e){e?r(JSON.parse(e)):r()},t)},t)})}WinJSContrib.Search.workerPath="./scripts/winjscontrib/winjscontrib.search.worker.js",WinJSContrib.Search.IndexGroup=function(e){if(this.indexes={},e)for(var n in e){var r=e[n];this.indexes[n]=r.async?new WinJSContrib.Search.Index(n,r.definition):new WinJSContrib.Search.IndexWorkerProxy(n,r.definition)}},WinJSContrib.Search.IndexGroup.prototype.addIndex=function(e,n,r,t){if(r)var i=new WinJSContrib.Search.IndexWorkerProxy(e,n);else var i=new WinJSContrib.Search.Index(e,n);return this.indexes[e]=i,t&&t.length?i.addRange(t).then(function(){return i}):WinJS.Promise.wrap(i)},WinJSContrib.Search.IndexGroup.prototype.addRange=function(e,n){var r=this.indexes[e];return r&&n&&n.length?r.addRange(n):WinJS.Promise.wrapError({message:"search index "+e+" not found"})},WinJSContrib.Search.IndexGroup.prototype.search=function(e){function n(n,t){return t.search(e).then(function(e){e&&e.length&&e.forEach(function(e){e.searchItemType=i,r.allResults.push(e)}),r[n]=e})}var r={hasResult:!1,allResults:[]},t=[];for(var i in this.indexes)t.push(n(i,this.indexes[i]));return WinJS.Promise.join(t).then(function(){return r.allResults.sort(function(e,n){return n.rank-e.rank}),r.hasResult=r.allResults.length>0,r})},WinJSContrib.Search.IndexGroup.prototype.save=function(){var e=[];for(var n in this.indexes)e.push(this.indexes[n].save());return WinJS.Promise.join(e)},WinJSContrib.Search.IndexGroup.prototype.load=function(){var e=[];for(var n in this.indexes)e.push(this.indexes[n].load());return WinJS.Promise.join(e)},WinJSContrib.Search.IndexGroup.prototype.dispose=function(){for(var e in this.indexes)this.indexes[e].dispose();this.indexes={}},WinJSContrib.Search.Index=function(e,n){var r=this;r.name=e||"defaultIndex",r.definition=n||{},r.items=[],r.storeData=!0,r.onprogress=void 0,r.stopWords=WinJSContrib.Search.Stemming.StopWords.common,r.pipeline=new WinJSContrib.Search.Stemming.Pipeline,r.pipeline.registerDefault(),r.folderPromise=Windows.Storage.ApplicationData.current.localFolder.createFolderAsync("WinJSContrib\\Search",Windows.Storage.CreationCollisionOption.openIfExists).then(function(e){return e},function(e){WinJS&&WinJS.log&&WinJS.log("Folder init error "+e.message)})},WinJSContrib.Search.Index.prototype.count=function(){return WinJS.Promise.wrap(this.items.length)},WinJSContrib.Search.Index.prototype.clear=function(){return this.items=[],WinJS.Promise.wrap()},WinJSContrib.Search.Index.prototype.dispose=function(){this.items=[],this.definition=void 0,this.stopWords=void 0,this.pipeline.clear(),this.pipeline=void 0,this.onprogress=void 0,this.folderPromise=void 0},WinJSContrib.Search.Index.prototype.export=function(){return{definition:this.definition,items:this.items}},WinJSContrib.Search.Index.prototype.toString=function(){return JSON.stringify(this.export())},WinJSContrib.Search.Index.prototype.loadData=function(e){var n=e;"String"==typeof n&&(n=JSON.parse(e)),n&&(n.definition&&n.definition.fields&&n.items&&n.items.length&&(this.definition=n.definition),this.items=n.items)},WinJSContrib.Search.Index.prototype.save=function(){var n=this,r=n.export();return n.folderPromise.then(function(t){return e(t,n.name,Windows.Storage.CreationCollisionOption.replaceExisting,r).then(function(){return{index:n}})})},WinJSContrib.Search.Index.prototype.load=function(){var e=this;return e.folderPromise.then(function(r){return n(r,e.name).then(function(n){e.loadData(n)})})},WinJSContrib.Search.Index.prototype._runSearch=function(e){for(var n=this,r=n.processText(e),t=[],i=n.items.length,o=-1,a=0;i>a;a++){var s=n._searchItem(r,n.items[a]);s&&t.push(s);var c=100*a/i<<0;n.onprogress&&c!=o&&n.onprogress({progressPercent:c,items:i,current:a}),o=c}return t=t.sort(function(e,n){return n.rank-e.rank})},WinJSContrib.Search.Index.prototype.search=function(e){return WinJS.Promise.wrap(this._runSearch(e))},WinJSContrib.Search.Index.prototype._searchItem=function(e,n){for(var r=n.items.length,t=0,i=0;r>i;i++){var o=n.items[i];e.untokenized&&o.tokens.untokenized==e.untokenized&&(t+=4*o.weight),e.untokenized&&o.tokens.untokenized&&o.tokens.untokenized.indexOf(e.untokenized)>=0&&(t+=2*o.weight);for(var a=0;a<o.tokens.items.length;a++)for(var s=o.tokens.items[a],c=0;c<e.items.length;c++){var p=e.items[c];p.length>1&&s==p&&(t+=o.weight),p.length>2&&s.indexOf(p)>=0&&(t+=.2*o.weight)}}return t?{rank:t,key:n.key,item:n.rawdata}:void 0},WinJSContrib.Search.Index.prototype.define=function(e){this.definition=e},WinJSContrib.Search.Index.prototype._add=function(e){var n=this,r=n.definition,t={items:[],rawdata:void 0,key:void 0};if(r&&r.fields){n.storeData&&(t.rawdata=e),r.key&&(t.key=WinJSContrib.Utils.readProperty(e,r.key));for(var i in r.fields)if(r.fields.hasOwnProperty(i)){var o=r.fields[i].weight||1,a=WinJSContrib.Utils.readProperty(e,i.split("."));a&&t.items.push({tokens:n.processText(a),weight:o})}return n.items.push(t),WinJS.Promise.wrap(t)}},WinJSContrib.Search.Index.prototype.add=function(e){return WinJS.Promise.wrap(this._add(e))},WinJSContrib.Search.Index.prototype.addRange=function(e,n,r){for(var t=this,i=e.length,o=[],a=-1,s=0;i>s;s++){var c=t._add(e[s],n);c&&o.push(c);var p=100*s/i<<0;r&&p!=a&&r({progressPercent:p,items:i,current:s}),a=p}return WinJS.Promise.wrap({indexed:o.length})},WinJSContrib.Search.Index.prototype.refresh=function(){var e=this,n=e.items,r=n.length;e.items=[];for(var t=0;r>t;t++){var i=e.items[t];e.add(i.rawdata)}e.items.push(res)},WinJSContrib.Search.Index.prototype.processText=function(e){for(var n=this.tokenize(e),r=[],t=n.length,i=0;t>i;i++){var o=this.pipeline.run(n[i]);o.length>1&&r.push(o)}return{items:r,untokenized:this.pipeline.run(e)}},WinJSContrib.Search.Index.prototype.checkWord=function(e){for(var n=this.stopWords.length,r=0;n>r;r++)if(e==this.stopWords[r])return"";return e},WinJSContrib.Search.Index.prototype.tokenize=function(e){var n=[];if(!e||!e.split)return n;for(var r=e.split(/\W+/),t=0;t<r.length;t++)r[t].length>0&&n.push(r[t]);return n},WinJSContrib.Search.IndexWorkerProxy=function(e,n,r){var t=this;t.worker=new WinJSContrib.Messenger.SmartWorker(r||WinJSContrib.Search.workerPath),t.init(e,n)},WinJSContrib.Search.IndexWorkerProxy.prototype.init=function(e,n,r){return this.worker.start("init",{name:e,load:r,definition:n})},WinJSContrib.Search.IndexWorkerProxy.prototype.search=function(e,n){return this.worker.start("search",{searchTerm:e,options:n})},WinJSContrib.Search.IndexWorkerProxy.prototype.count=function(){return this.worker.start("count")},WinJSContrib.Search.IndexWorkerProxy.prototype.add=function(e,n){return this.worker.start("index",{items:[e],options:n})},WinJSContrib.Search.IndexWorkerProxy.prototype.addRange=function(e,n){return this.worker.start("index",{items:e,options:n})},WinJSContrib.Search.IndexWorkerProxy.prototype.dispose=function(){this.worker.dispose()},WinJSContrib.Search.IndexWorkerProxy.prototype.clear=function(){return this.worker.start("clear")},WinJSContrib.Search.IndexWorkerProxy.prototype.load=function(){return this.worker.start("load")},WinJSContrib.Search.IndexWorkerProxy.prototype.save=function(){return this.worker.start("save")},WinJSContrib.Search.Stemming={},WinJSContrib.Search.Stemming.Pipeline=function(){this._processors=[]},WinJSContrib.Search.Stemming.Pipeline.prototype.add=function(e){this._processors.push(e)},WinJSContrib.Search.Stemming.Pipeline.prototype.clear=function(){this._processors=[]},WinJSContrib.Search.Stemming.Pipeline.prototype.run=function(e){for(var n=this._processors.length,r=e,t=0;n>t;t++)r=this._processors[t](r);return r},WinJSContrib.Search.Stemming.StopWords={common:["de","du","des","le","la","les","te","ta","ton","tes","un","une","et","ou","mais","pour","par","avec","si","a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]},WinJSContrib.Search.Stemming.Pipeline.prototype.registerDefault=function(){var e=this;e.add(WinJSContrib.Search.Stemming.Op.lowerCase),e.add(WinJSContrib.Search.Stemming.Op.removeDiacritics),e.add(WinJSContrib.Search.Stemming.Op.dedup),e.add(WinJSContrib.Search.Stemming.Op.dropInitialLetters),e.add(WinJSContrib.Search.Stemming.Op.dropBafterMAtEnd),e.add(WinJSContrib.Search.Stemming.Op.transformCK),e.add(WinJSContrib.Search.Stemming.Op.cTransform),e.add(WinJSContrib.Search.Stemming.Op.dTransform),e.add(WinJSContrib.Search.Stemming.Op.dropG),e.add(WinJSContrib.Search.Stemming.Op.transformG),e.add(WinJSContrib.Search.Stemming.Op.dropH),e.add(WinJSContrib.Search.Stemming.Op.transformPH),e.add(WinJSContrib.Search.Stemming.Op.transformQ),e.add(WinJSContrib.Search.Stemming.Op.transformS),e.add(WinJSContrib.Search.Stemming.Op.transformX),e.add(WinJSContrib.Search.Stemming.Op.transformT),e.add(WinJSContrib.Search.Stemming.Op.dropT),e.add(WinJSContrib.Search.Stemming.Op.transformV),e.add(WinJSContrib.Search.Stemming.Op.transformWH),e.add(WinJSContrib.Search.Stemming.Op.dropW),e.add(WinJSContrib.Search.Stemming.Op.dropY),e.add(WinJSContrib.Search.Stemming.Op.transformZ)},WinJSContrib.Search.Stemming.Op={lowerCase:function(e){return e.toLowerCase()},dedup:function(e){return e.replace(/([^c])\1/g,"$1")},dropInitialLetters:function(e){return e.match(/^(kn|gn|pn|ae|wr)/)?e.substr(1,e.length-1):e},dropBafterMAtEnd:function(e){return e.replace(/mb$/,"m")},cTransform:function(e){return e=e.replace(/([^s]|^)(c)(h)/g,"$1x$3").trim(),e=e.replace(/cia/g,"xia"),e=e.replace(/c(i|e|y)/g,"s$1"),e=e.replace(/c/g,"k")},dTransform:function(e){return e=e.replace(/d(ge|gy|gi)/g,"j$1"),e=e.replace(/d/g,"t")},dropG:function(e){return e=e.replace(/gh(^$|[^aeiou])/g,"h$1"),e=e.replace(/g(n|ned)$/g,"$1")},transformG:function(e){return e=e.replace(/([^g]|^)(g)(i|e|y)/g,"$1j$3"),e=e.replace(/gg/g,"g"),e=e.replace(/g/g,"k")},dropH:function(e){return e.replace(/([aeiou])h([^aeiou])/g,"$1$2")},transformCK:function(e){return e.replace(/ck/g,"k")},transformPH:function(e){return e.replace(/ph/g,"f")},transformQ:function(e){return e.replace(/q/g,"k")},transformS:function(e){return e.replace(/s(h|io|ia)/g,"x$1")},transformT:function(e){return e=e.replace(/t(ia|io)/g,"x$1"),e=e.replace(/th/,"0")},dropT:function(e){return e.replace(/tch/g,"ch")},transformV:function(e){return e.replace(/v/g,"f")},transformWH:function(e){return e.replace(/^wh/,"w")},dropW:function(e){return e.replace(/w([^aeiou]|$)/g,"$1")},transformX:function(e){return e=e.replace(/^x/,"s"),e=e.replace(/x/g,"ks")},dropY:function(e){return e.replace(/y([^aeiou]|$)/g,"$1")},transformZ:function(e){return e.replace(/z/,"s")},dropVowels:function(e){return e.charAt(0)+e.substr(1,e.length).replace(/[aeiou]/g,"")},removeDiacritics:function(e){var n=e.toLowerCase();return n=n.replace(new RegExp("/.../g","g")," "),n=n.replace(new RegExp("[àáâãäå]","g"),"a"),n=n.replace(new RegExp("æ","g"),"ae"),n=n.replace(new RegExp("ç","g"),"c"),n=n.replace(new RegExp("[èéêë]","g"),"e"),n=n.replace(new RegExp("[ìíîï]","g"),"i"),n=n.replace(new RegExp("ñ","g"),"n"),n=n.replace(new RegExp("[òóôõö]","g"),"o"),n=n.replace(new RegExp("œ","g"),"oe"),n=n.replace(new RegExp("[ùúûü]","g"),"u"),n=n.replace(new RegExp("[ýÿ]","g"),"y"),n=n.replace(new RegExp("['\"]","g")," ")}}}();