!function(){WinJS.Namespace.define("WinJSContrib.UI",{parentChildView:function(e){for(var n=e.parentNode;n;){if(n.mcnChildnav)return n.winControl;n=n.parentNode}},ChildViewFlyout:WinJS.Class.mix(WinJS.Class.define(function(e,n){e.winControl=this,n=n||{},this.element=e||document.createElement("div"),this.$element=$(e),this.element.mcnChildnav=!0,this.$element.addClass("childNavigator"),this._createContent(),this.isOpened=!1,this.hardwareBackBtnPressedBinded=this.hardwareBackBtnPressed.bind(this),this.cancelNavigationBinded=this.cancelNavigation.bind(this)},{_createContent:function(){var e=this;this.overlay=document.createElement("div"),this.overlay.className="childNavigator-overlay",this.$overlay=$(this.overlay),this.$overlay.removeClass("visible"),this.element.appendChild(this.overlay),this.$overlay.click(function(){e.hide()}),this.contentPlaceholder=document.createElement("div"),this.contentPlaceholder.className="childNavigator-contentPlaceholder";var n=document.createElement("DIV");this.contentPlaceholder.appendChild(n),this.navigator=new WinJSContrib.UI.PageControlNavigator(n,{global:!1}),this.navigator.hide=function(n){return e.hide(n)},this.$contentPlaceholder=$(this.contentPlaceholder),this.element.appendChild(this.contentPlaceholder)},navigate:function(e,n){var t=this;return t.navigator.navigate(e,n)},pageControl:{get:function(){return this.container&&this.container.winControl}},clear:function(){var e=this;return new WinJS.Promise(function(n){WinJS.Promise.wrap(e.closePage()).done(function(){e.navigator.clear(),e.navigator._element.innerText="",e.location=void 0,n()})})},closePage:function(e,n){var t=this;return t.canClose()?(1==t.navigator._element.children.length&&t.hide(e),t.navigator.triggerPageExit(),t.navigator.closePage(n).then(function(){WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide()})):WinJS.Promise.wrapError()},back:function(e){var n=this;return n.navigator.back(e)},canGoBack:function(){return that.navigator.canGoBack},_childContentKeyUp:function(e){"Esc"===e.key&&this.hide()},hardwareBackBtnPressed:function(e){var n=this,t=WinJSContrib.UI.FlyoutPage.openPages.indexOf(n);t==WinJSContrib.UI.FlyoutPage.openPages.length-1&&(n.hide(),e.handled=!0,e.preventDefault&&e.preventDefault())},cancelNavigation:function(e){var n=new WinJS.Promise(function(){});e.detail.setPromise(n),setImmediate(function(){n.cancel()})},show:function(e){var n=this;n.isOpened||(document.body.addEventListener("keyup",n.childContentKeyUp),n.isOpened=!0,$(n.element).addClass("visible"),n.$overlay.addClass("visible"),e||n.$contentPlaceholder.addClass("visible"),WinJS.Navigation.addEventListener("beforenavigate",this.cancelNavigationBinded),window.Windows&&window.Windows.Phone?Windows.Phone.UI.Input.HardwareButtons.addEventListener("backpressed",this.hardwareBackBtnPressedBinded):document.addEventListener("backbutton",this.hardwareBackBtnPressedBinded,!0),WinJSContrib.UI.Application&&WinJSContrib.UI.Application.navigator&&WinJSContrib.UI.Application.navigator.addLock())},pick:function(e,n,t){var i=this;return n=n||{},new WinJS.Promise(function(a){var o=!1,r=null,s=function(){r&&r.removeEventListener("closing",s),i.removeEventListener("beforehide",s),o||(o=!0,a({completed:!1,data:null}))};n.navigateStacked=!0,n.injectToPage={close:function(e){o=!0,r&&r.removeEventListener("closing",s),i.removeEventListener("beforehide",s),i.closePage(e,this.element).then(function(){a({completed:!0,data:e})})},cancel:function(){s(),i.closePage()}},i.open(e,n,t).then(function(){r=i.navigator.pageControl,r.addEventListener("closing",s),i.addEventListener("beforehide",s,!1)})})},open:function(e,n,t){var i=this;return $(i.element).addClass("visible"),i.dispatchEvent("beforeshow"),i.$overlay.addClass("visible"),i.$contentPlaceholder.addClass("visible"),new WinJS.Promise(function(a,o){i.isOpened||i.show(!0),setImmediate(function(){i.navigate(e,n,t).done(function(e){i.dispatchEvent("aftershow"),a(e)},o)})})},canClose:function(){return this.navigator.pageControl&&this.navigator.pageControl.canClose&&!this.navigator.pageControl.canClose()?!1:!0},hide:function(e){var n=this;if(n.isOpened){if(!n.canClose())return!1;document.body.removeEventListener("keyup",n.childContentKeyUp),n.isOpened=!1,n.dispatchEvent("beforehide",e),WinJSContrib.UI.Application&&WinJSContrib.UI.Application.navigator&&WinJSContrib.UI.Application.navigator.removeLock(),WinJS.Navigation.removeEventListener("beforenavigate",this.cancelNavigationBinded),window.Windows&&window.Windows.Phone?Windows.Phone.UI.Input.HardwareButtons.removeEventListener("backpressed",this.hardwareBackBtnPressedBinded):document.removeEventListener("backbutton",this.hardwareBackBtnPressedBinded),n.$overlay.hasClass("visible")&&(n.$contentPlaceholder.afterTransition(function(){n.clear(),$(n.element).removeClass("visible"),n.dispatchEvent("afterhide",e)}),n.$overlay.removeClass("visible"),n.$contentPlaceholder.removeClass("visible"))}return!0}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("beforeshow","beforehide","aftershow","afterhide"))})}();